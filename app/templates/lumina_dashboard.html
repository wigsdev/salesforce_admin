{% extends "base.html" %}

{% block title %}Comando Lumina Tech - Salesforce Admin{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8" x-data="luminaCommandCenter()">

    <!-- BRANDING HEADER (Lumina Blue #005A9C) -->
    <div
        class="mb-8 p-6 rounded-2xl bg-gradient-to-r from-[#005A9C] to-[#00477D] text-white shadow-lg relative overflow-hidden">
        <!-- Background Pattern -->
        <div class="absolute inset-0 opacity-10"
            style="background-image: url('data:image/svg+xml,%3Csvg width=\'20\' height=\'20\' viewBox=\'0 0 20 20\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\' fill-rule=\'evenodd\'%3E%3Ccircle cx=\'3\' cy=\'3\' r=\'3\'/%3E%3Ccircle cx=\'13\' cy=\'13\' r=\'3\'/%3E%3C/g%3E%3C/svg%3E');">
        </div>

        <div class="relative z-10 flex justify-between items-center">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <span
                        class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider backdrop-blur-sm">Sprint
                        1</span>
                    <span
                        class="bg-emerald-400/20 text-emerald-100 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider backdrop-blur-sm border border-emerald-400/30">En
                        Curso</span>
                </div>
                <h1 class="text-4xl font-black tracking-tight mb-1">Lumina Tech üèõÔ∏è</h1>
                <p class="text-blue-100 font-medium text-lg">Centro de Comando de Implementaci√≥n</p>
            </div>

            <!-- Quick Actions -->
            <div class="hidden md:flex gap-3">
                <a href="/docs/browse/Lumina_Tech/00-MASTER_INDEX.md"
                    class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg backdrop-blur-sm transition font-medium border border-white/20 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    Master Index
                </a>
            </div>
        </div>
    </div>

    <!-- ROLE FILTER (Clase 9 Requirement) -->
    <div
        class="mb-8 flex flex-col md:flex-row gap-4 items-center justify-between bg-white dark:bg-dark-surface p-4 rounded-xl border border-gray-100 dark:border-dark-border shadow-sm">
        <div class="flex items-center gap-3">
            <span class="text-gray-500 font-medium">Filtrar por Rol:</span>
            <select x-model="selectedRole"
                class="form-select bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-[#005A9C] focus:border-[#005A9C]">
                <option value="all">üë• Todos los Roles</option>
                <option value="admin">‚öôÔ∏è Salesforce Admin</option>
                <option value="consultant">üèóÔ∏è Consultant / Architect</option>
                <option value="qa">üß™ QA Tester</option>
                <option value="po">üëî Product Owner / BA</option>
            </select>
        </div>

        <!-- KPI MINI DASHBOARD (Clase 14 Style) -->
        <div class="flex gap-6">
            <div class="text-center">
                <span class="block text-2xl font-bold text-gray-900 dark:text-white"
                    x-text="stats.completedTasks">0</span>
                <span class="text-xs text-gray-500 uppercase font-bold">Tareas (HU)</span>
            </div>
            <div class="text-center border-l border-gray-200 dark:border-gray-700 pl-6">
                <span class="block text-2xl font-bold text-[#005A9C] dark:text-[#4BCA81]"
                    x-text="metrics.dataQuality + '%'">0%</span>
                <span class="text-xs text-gray-500 uppercase font-bold">Data Quality</span>
            </div>
        </div>
    </div>

    <!-- WORKSTREAMS GRID -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">

        <!-- 1. ESTRATEGIA & ROLES -->
        <div class="bg-white dark:bg-dark-surface rounded-xl shadow-sm border border-gray-100 dark:border-dark-border overflow-hidden transition-all duration-300 hover:shadow-md group"
            :class="{'opacity-50': shouldDim('po')}">
            <div
                class="p-4 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 border-l-4 border-purple-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">1. Estrategia & Roles</h3>
                        <p class="text-xs text-gray-500">Clase 9: Definici√≥n del Equipo</p>
                    </div>
                    <span
                        class="w-8 h-8 rounded-lg flex items-center justify-center text-lg bg-purple-100 text-purple-600">üëî</span>
                </div>
            </div>
            <div class="p-4 space-y-3">
                <template x-for="task in getTasks('strategy')" :key="task.id">
                    <label
                        class="flex items-start gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                        <input type="checkbox" class="mt-1 rounded text-purple-600 focus:ring-purple-500"
                            :checked="task.done" @change="toggle(task.id)">
                        <span class="text-sm text-gray-700 dark:text-gray-300"
                            :class="{'line-through text-gray-400': task.done}" x-text="task.desc"></span>
                        <span x-show="task.role"
                            class="ml-auto text-[10px] uppercase font-bold px-1.5 py-0.5 rounded bg-gray-100 text-gray-500"
                            x-text="task.role"></span>
                    </label>
                </template>
            </div>
        </div>

        <!-- 2. ESTRUCTURA DE DATOS -->
        <div class="bg-white dark:bg-dark-surface rounded-xl shadow-sm border border-gray-100 dark:border-dark-border overflow-hidden transition-all duration-300 hover:shadow-md group"
            :class="{'opacity-50': shouldDim('consultant')}">
            <div
                class="p-4 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 border-l-4 border-blue-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">2. Modelo de Datos</h3>
                        <p class="text-xs text-gray-500">Clase 10: Objetos y Relaciones</p>
                    </div>
                    <span
                        class="w-8 h-8 rounded-lg flex items-center justify-center text-lg bg-blue-100 text-blue-600">üèóÔ∏è</span>
                </div>
            </div>
            <div class="p-4 space-y-3">
                <template x-for="task in getTasks('data_model')" :key="task.id">
                    <label
                        class="flex items-start gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                        <input type="checkbox" class="mt-1 rounded text-blue-600 focus:ring-blue-500"
                            :checked="task.done" @change="toggle(task.id)">
                        <span class="text-sm text-gray-700 dark:text-gray-300"
                            :class="{'line-through text-gray-400': task.done}" x-text="task.desc"></span>
                    </label>
                </template>
            </div>
        </div>

        <!-- 3. L√ìGICA & CALIDAD (VALIDACIONES) -->
        <div class="bg-white dark:bg-dark-surface rounded-xl shadow-sm border border-gray-100 dark:border-dark-border overflow-hidden transition-all duration-300 hover:shadow-md group"
            :class="{'opacity-50': shouldDim('qa')}">
            <div
                class="p-4 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 border-l-4 border-red-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">3. Reglas & Calidad</h3>
                        <p class="text-xs text-gray-500">Clase 10: Validaciones y F√≥rmulas</p>
                    </div>
                    <span
                        class="w-8 h-8 rounded-lg flex items-center justify-center text-lg bg-red-100 text-red-600">üß™</span>
                </div>
            </div>
            <div class="p-4 space-y-3">
                <template x-for="task in getTasks('logic')" :key="task.id">
                    <label
                        class="flex items-start gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                        <input type="checkbox" class="mt-1 rounded text-red-600 focus:ring-red-500" :checked="task.done"
                            @change="toggle(task.id)">
                        <div>
                            <span class="block text-sm text-gray-700 dark:text-gray-300"
                                :class="{'line-through text-gray-400': task.done}" x-text="task.desc"></span>
                            <span x-show="task.tech" class="text-[10px] text-red-500 font-mono"
                                x-text="task.tech"></span>
                        </div>
                    </label>
                </template>
            </div>
        </div>

        <!-- 4. IDENTIDAD & UI -->
        <div class="bg-white dark:bg-dark-surface rounded-xl shadow-sm border border-gray-100 dark:border-dark-border overflow-hidden transition-all duration-300 hover:shadow-md group"
            :class="{'opacity-50': shouldDim('admin')}">
            <div
                class="p-4 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 border-l-4 border-emerald-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">4. Identidad Visual</h3>
                        <p class="text-xs text-gray-500">Clase 10: Apps y Branding</p>
                    </div>
                    <span
                        class="w-8 h-8 rounded-lg flex items-center justify-center text-lg bg-emerald-100 text-emerald-600">üé®</span>
                </div>
            </div>
            <div class="p-4 space-y-3">
                <template x-for="task in getTasks('ui')" :key="task.id">
                    <label
                        class="flex items-start gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                        <input type="checkbox" class="mt-1 rounded text-emerald-600 focus:ring-emerald-500"
                            :checked="task.done" @change="toggle(task.id)">
                        <span class="text-sm text-gray-700 dark:text-gray-300"
                            :class="{'line-through text-gray-400': task.done}" x-text="task.desc"></span>
                    </label>
                </template>
            </div>
        </div>

    </div>
</div>



<script>
    function luminaCommandCenter() {
        return {
            selectedRole: 'all',
            stats: { completedTasks: 0 },
            metrics: { dataQuality: 85 }, // Simulated metric

            // STATIC TASKS (Simulating Database Source based on Class 10 Docs)
            tasks: [
                // STRATEGY
                { id: 101, category: 'strategy', desc: 'Definir Matriz de Roles (6 Integrantes)', done: true, role: 'po' },
                { id: 102, category: 'strategy', desc: 'Crear Historias de Usuario en Trello', done: false, role: 'po' },

                // DATA MODEL
                { id: 201, category: 'data_model', desc: 'Objeto Custom: Carrera', done: false, role: 'consultant' },
                { id: 202, category: 'data_model', desc: 'Objeto Custom: Materia', done: false, role: 'consultant' },
                { id: 203, category: 'data_model', desc: 'Objeto Custom: Alumno (Golden Rec)', done: false, role: 'consultant' },
                { id: 204, category: 'data_model', desc: 'Junction Object: Inscripci√≥n', done: false, role: 'consultant' },

                // LOGIC
                { id: 301, category: 'logic', desc: 'Regla Validaci√≥n: Email Institucional (@lumina.edu)', tech: 'NOT(REGEX(...))', done: false, role: 'qa' },
                { id: 302, category: 'logic', desc: 'Regla Validaci√≥n: Nota (0-10)', tech: 'OR(Nota<0, Nota>10)', done: false, role: 'qa' },
                { id: 303, category: 'logic', desc: 'F√≥rmula: Sem√°foro Alumno (Img)', tech: 'IMAGE(...)', done: false, role: 'qa' },
                { id: 304, category: 'logic', desc: 'F√≥rmula: Estado Cursada (Aprob/Reprob)', tech: 'IF(...)', done: false, role: 'qa' },

                // UI
                { id: 401, category: 'ui', desc: 'Configurar Dominio (My Domain)', done: false, role: 'admin' },
                { id: 402, category: 'ui', desc: 'Crear App "Gesti√≥n Acad√©mica"', done: false, role: 'admin' },
                { id: 403, category: 'ui', desc: 'Aplicar Branding (Lumina Blue #005A9C)', done: false, role: 'admin' },
                { id: 404, category: 'ui', desc: 'Configurar Lightning Pages (Alumno)', done: false, role: 'admin' }
            ],

            init() {
                this.calculateStats();
            },

            getTasks(cat) {
                return this.tasks.filter(t => t.category === cat);
            },

            shouldDim(taskRole) {
                if (this.selectedRole === 'all') return false;
                return taskRole !== this.selectedRole;
            },

            toggle(id) {
                const t = this.tasks.find(x => x.id === id);
                if (t) {
                    t.done = !t.done;
                    this.calculateStats();

                    // Simulate saving
                    window.showToast(t.done ? 'Tarea completada' : 'Tarea pendiente', 'info');
                }
            },

            calculateStats() {
                this.stats.completedTasks = this.tasks.filter(t => t.done).length;
                // Simulate Data Quality increasing as tasks complete
                this.metrics.dataQuality = 70 + (this.stats.completedTasks * 2);
            }
        }
    }
</script>
{% endblock %}